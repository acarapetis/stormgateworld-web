---
import { Race, type PlayerMatchupsStats } from "../../lib/api"
import Widget from "../Widget.astro"
import { styles } from "../../lib/theme"
import { Image } from "astro:assets"
import infernals from "../../assets/game/factions/infernals-small.png"
import vanguard from "../../assets/game/factions/vanguard-small.png"

type Theme = keyof typeof styles.badges
interface Props {
  playerMatchupStats: PlayerMatchupsStats
}

const { playerMatchupStats } = Astro.props
const matchupsSortedByRace = playerMatchupStats.matchups.sort((a, b) => a.race.localeCompare(b.race))
---

<Widget title="Winrates by matchup">
  <div class="flex flex-col gap-2">
    {
      matchupsSortedByRace.map((matchup) => (
        <div
          class:list={[
            "rounded-lg px-3 py-2 -mx-2 flex items-center gap-3 text-sm sm:text-base justify-between",
            styles.badges[matchup.race as Theme].badge,
          ]}
        >
          <div class="flex gap-2">
            <Image src={matchup.race === "infernals" ? infernals : vanguard} alt={matchup.race} class="size-6" />
            vs
            <Image
              src={matchup.opponent_race === "infernals" ? infernals : vanguard}
              alt={matchup.opponent_race}
              class="size-6"
            />
          </div>
          {Math.round(matchup.aggregated.win_rate)} %
        </div>
      ))
    }
  </div>
</Widget>
